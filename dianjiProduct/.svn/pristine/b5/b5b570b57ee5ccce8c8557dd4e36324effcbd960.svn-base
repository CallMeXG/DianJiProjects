

var companyArray = new Array();
var reginArray = new Array();
var companyID = null;
var regionID = null;

getInitCompany();

function getInitCompany() {
	$.ajax({
		type: "get",
		url: commen_gain_company_map_Interface,
		async: true,
		dataType: "json",
		success: function(respData) {
			console.log(JSON.stringify(respData))
			var dataArray = respData.data;
			for(var i = 0; i < dataArray.length; i++) {
				var subRegionArray = dataArray[i].region_list;
				var company_region = new Array();
				for(var j = 0; j < subRegionArray.length; j++) {
					var obj_subRegion = {
						value: subRegionArray[j].id,
						text: subRegionArray[j].region_name
					}
					company_region.push(obj_subRegion);
				}

				var obj_company = {
					value: dataArray[i].id,
					text: dataArray[i].company_name,
					children: company_region
				};
				companyArray.push(obj_company)
			}
		}
	});
}

//选择出厂时间
$("#devices_out_time").jeDate({
	format: "YYYY-MM-DD"
});
//选择所属公司
$("#id_companyName").click(function() {
	var userPicker = new mui.PopPicker();
	var setdataArray = new Array();
	console.log(JSON.stringify(companyArray));
	userPicker.setData(companyArray);
	var strid = "id_companyName";
	var userResult = document.getElementById(strid);
	userPicker.show(function(items) {
		userResult.value = items[0].text;
		companyID = items[0].value;
		regionID = null;
		reginArray = items[0].children;
		$("#id_changName").val("");
	});
})
//选择所属厂区
$("#id_changName").click(function() {
	var userPicker = new mui.PopPicker();
	userPicker.setData(reginArray);
	var strid = "id_changName";
	var userResult = document.getElementById(strid);
	userPicker.show(function(items) {
		userResult.value = items[0].text;
		regionID = items[0].value;
	});
})

$('#addDevice').click(function() {

	var company_id = companyID;
	var region_id = regionID;

	var devices_name = $('#devices_name').val();
	var devices_no = $('#devices_no').val();
	var devices_model = $('#devices_model').val();
	var company = $('#company').val();
	var devices_out_time = $('#devices_out_time').val();
	var devices_power = $('#devices_power').val();
	var install_way = $('#install_way').val();
	var work_voltage = $('#work_voltage').val();
	var devices_produce = $('#devices_produce').val();
	var power_factor = $('#power_factor').val();
	var protection = $('#protection').val();
	var insulation = $('#insulation').val();
	var bearing_model = $('#bearing_model').val();
	var work_shop = $('#work_shop').val();
	var pro_line = $('#pro_line').val();
	var use_scenes = $('#use_scenes').val();
	var create_time = $('#create_time').val();
	
	//新增
	var zhuansu = $('#add_zhuansu').val();
	var duishu = $('#add_duishu').val();
	var gangdu = $('#add_gangdu').val();
	var jiegoutu = $('#add_jigoutu').val();
	var chuandongbi = $('#add_chuandongbi').val();
	var chilunshu = $('#add_chilunshu').val();
	var lianzhouType = $('#add_lianzhoutype').val();

	if(companyID == null) {
		mui.toast('请选择所属公司');
		return false;
	}
	if(region_id == null) {
		mui.toast('请选择所属厂区');
		return false;
	}

	if(devices_name == '' || devices_name == undefined) {
		mui.toast('设备名称不能为空');
		return false;
	}
	if(devices_no == '' || devices_no == undefined) {
		mui.toast('设备编号不能为空');
		return false;
	}

	if(devices_model == '' || devices_model == undefined) {
		mui.toast('设备型号不能为空');
		return false;
	}

	if(company == '' || company == undefined) {
		mui.toast('企业名称不能为空');
		return false;
	}
	/*
	if(devices_out_time == '' || devices_out_time == undefined) {
		mui.toast('出厂时间不能为空');
		return false;
	}
	if(devices_power == '' || devices_power == undefined) {
		mui.toast('额定功率不能为空');
		return false;
	}
	if(install_way == '' || install_way == undefined) {
		mui.toast('安装方式不能为空');
		return false;
	}
	if(work_voltage == '' || work_voltage == undefined) {
		mui.toast('工作电压不能为空');
		return false;
	}
	if(devices_produce == '' || devices_produce == undefined) {
		mui.toast('生产厂商不能为空');
		return false;
	}

	if(power_factor == '' || power_factor == undefined) {
		mui.toast('功率因数不能为空');
		return false;
	}

	if(protection == '' || protection == undefined) {
		mui.toast('防护等级不能为空');
		return false;
	}
	if(insulation == '' || insulation == undefined) {
		mui.toast('绝缘等级不能为空');
		return false;
	}
	if(bearing_model == '' || bearing_model == undefined) {
		mui.toast('轴承型号不能为空');
		return false;
	}
	if(zhuansu == '' || zhuansu == undefined) {
		mui.toast('电机额定转速不能为空');
		return false;
	}
	if(duishu == '' || duishu == undefined) {
		mui.toast('电机磁极对数不能为空');
		return false;
	}
	if(gangdu == '' || gangdu == undefined) {
		mui.toast('电机基座刚度不能为空');
		return false;
	}
	if(jiegoutu == '' || jiegoutu == undefined) {
		mui.toast('齿轮箱结构图不能为空');
		return false;
	}
	if(chuandongbi == '' || chuandongbi == undefined) {
		mui.toast('齿轮箱传动比不能为空');
		return false;
	}
	if(chilunshu == '' || chilunshu == undefined) {
		mui.toast('齿轮箱齿轮数不能为空');
		return false;
	}
	if(lianzhouType == '' || lianzhouType == undefined) {
		mui.toast('电机联轴器类型不能为空');
		return false;
	}
	//*/
	if(work_shop == '' || work_shop == undefined) {
		mui.toast('分厂不能为空');
		return false;
	}
	if(pro_line == '' || pro_line == undefined) {
		mui.toast('生产产线不能为空');
		return false;
	}
	if(use_scenes == '' || use_scenes == undefined) {
		mui.toast('应用场景不能为空');
		return false;
	}
//	if(create_time == '' || create_time == undefined) {
//		mui.toast('维修日期不能为空');
//		return false;
//	}
	

	var data = {
		strLoginId: localStorage.getItem("strLoginId"),
		strLoginToken: localStorage.getItem("strLoginToken"),
		company_id: company_id,
		region_id: region_id,
		devices_name: devices_name,
		devices_no: devices_no,
		devices_model: devices_model,
		company: company,
		devices_out_time: devices_out_time,
		devices_power: devices_power,
		install_way: install_way,
		work_voltage: work_voltage,
		devices_produce: devices_produce,
		power_factor: power_factor,
		protection: protection,
		insulation: insulation,
		bearing_model: bearing_model,
		work_shop: work_shop,
		pro_line: pro_line,
		use_scenes: use_scenes,
		create_time: create_time,
		rated_speed:zhuansu,
		magnetism_pair:duishu,
		base_rigidity:gangdu,
		gearbox_transmission_ratio:chuandongbi,
		gearbox_gear_pair:chilunshu,
		coupling_type:lianzhouType
	};

	console.log(JSON.stringify(data));

	$.ajax({
		type: "get",
		url: commen_add_device_Interface,
		async: true,
		dataType: 'json',
		data: data,
		success: function(msg) {
							console.log(msg);
			if(msg.status == "SUCCESS") {
				mui.toast(msg.message);
				window.location.replace('./newIndex.html');

			} else if(msg.status = "FAILED") {
				mui.toast(msg.message);
			}
		}
	});

})