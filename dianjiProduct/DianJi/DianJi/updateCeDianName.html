<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>修改测点名称</title>
		<link rel="stylesheet" href="css/mui.min.css" />
		<link href="css/mui.picker.css" rel="stylesheet" />
		<link href="css/mui.poppicker.css" rel="stylesheet" />


	</head>
	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #524598;">
			<a style="color: white;" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 style="color: white;" class="mui-title ">测点修改</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" id="install_list">
					<a class="mui-navigate-right">
						<span>选择测点</span>
						<span id="cedianOldName" style="float: right;margin-right: 15px;"></span>
					</a>
				</li>
				<input id="textID" style="float: left;margin-top: 10px;" type="text" placeholder="请在此输入测点名称" class="mui-input-clear" />
			</ul>
			<button onclick="updateInstallText()" class="mui-btn mui-btn-success" style="width: 50%;margin-left: 25%;">修改</button>

		</div>

		<script src="js/url_all.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.picker.js"></script>
		<script src="js/mui.poppicker.js"></script>
		<script src="js/common.js"></script>
		<script>
			var strID = null;
			var strText = null;
			strUpdateText = null;
			var wo = null;
			var ws = null,
				domready = false;

			function plusReady() {
				if (ws || !window.plus || !domready) {
					return;
				}
				// 获取窗口对象
				ws = plus.webview.currentWebview();
				wo = ws.opener();
			}
			if (window.plus) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}

			var objInstall_list = new Array();
			//获取设备测点列表
			getInstallList();

			function getInstallList() {
				$.ajax({
					type: "get",
					url: new_commen_gain_device_install_Interface,
					async: true,
					data: {
						strLoginId: localStorage.getItem("strLoginId"),
						strLoginToken: localStorage.getItem("strLoginToken"),
						devices_no: localStorage.DeveciId
					},
					dataType: "json",
					success: function(respData) {
						console.log('---------'+ JSON.stringify(respData))
						if (respData.status == 'SUCCESS') {
							if (respData.data.length > 0) {
								objInstall_list = respData.data;
							} else {
								mui.toast('测点位置列表为空！');
							}
						} else {
							mui.toast('获取测点位置列表失败！');
						}
					}
				});
			};

			$('#install_list').on('tap', function() {
				console.log("-=-=-=-=-=");
				var userPicker = new mui.PopPicker();
				var setdataArray = new Array();
				for (var i = 0; i < objInstall_list.length; i++) {
					var obj_install = {
						id: objInstall_list[i].id,
						devices_no: objInstall_list[i].devices_no,
						install_no: objInstall_list[i].install_no,
						text: objInstall_list[i].install_xy,
						install_num: objInstall_list[i].install_num,
						status: objInstall_list[i].status
					}
					setdataArray.push(obj_install);
					installList = [];
					installList.push(obj_install);
				}
				userPicker.setData(setdataArray);
				var userResult = document.getElementById("cedianOldName");
				userPicker.show(function(items) {
					userResult.innerHTML = items[0].text;
					strText = items[0].text;
					strID = items[0].id;
				});
			})

			//修改测点名称
			function updateInstallText() {
				strUpdateText = document.getElementById('textID').value;
				if (strUpdateText == null) {
					mui.alert("测点名称不得为空！");
				} else {
					if (strText == null) {
						mui.alert("请先选择测点位置！");
					} else {

						if (strUpdateText == strText) {
							mui.alert("输入名称与原测点名称重复!");
						} else {
							$.ajax({
								type: "POST",
								url: new_commen_update_device_install_Interface,
								async: true,
								data: {
									strLoginId: localStorage.getItem("strLoginId"),
									strLoginToken: localStorage.getItem("strLoginToken"),
									devices_no: localStorage.DeveciId,
									install_id: strID,
									install_xy: strUpdateText
								},
								dataType: "json",
								success: function(respData) {
									console.log('changechange---------')
									if (respData.status == 'SUCCESS') {
										mui.toast('修改测点名称成功！');
										// wo.evalJS("reloadSensor();");
										location.reload();
									} else {
										mui.toast("测点名称修改失败：" + respData.message);
									}
								}
							});

						}

					}
				}
			}
		</script>
	</body>
</html>
