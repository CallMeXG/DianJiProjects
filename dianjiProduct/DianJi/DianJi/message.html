<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>消息</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css" />
		<script src="js/vue.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/pagination.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #524598;">
			<a class="mui-action-back mui-icon mui-icon-back mui-pull-left" style="color: white;"></a>
			<a class="mui-title" style="color: white;">消息</a>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view" id="messageListID" style="display: none;">
				<li class="mui-table-view-cell" v-for="msgItem in mesList">
					<template v-if="msgItem.create_time !== undefined">
						<p>{{msgItem.create_time.substr(0,19)}}</p>
					</template>
					<p style="margin-top: 5px;">{{msgItem.event_info}}</p>
				</li>

			</ul>
			<div style="height: 50px;margin-top: 10px;text-align: center;">
				<div id="pagination_9" style="width: 100%;height: 30px;margin-top: 10px;"></div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/url_all.js"></script>

		<script src="js/highlight.min.js"></script>
		<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
		<script src="js/jquery.pagination.js"></script>
		<script type="text/javascript" src="js/pagination.min.js"></script>
		<script>
			// 
			mui.plusReady(function() {


				var msgVue = new Vue({
					el: '#messageListID',
					data: {
						mesList: []
					}
				})

				//获取报告列表
				getBaoGaoList(0, 1);

				function getBaoGaoList(startIndex, thisIndex) {
					plus.nativeUI.showWaiting('正在获取消息，请稍后...');
					$.ajax({
						type: "get",
						url: new_commen_gain_event_list_Interface,
						async: true,
						dataType: 'json',
						data: {
							id: localStorage.getItem('strLoginId'),
							c_id: localStorage.getItem("c_id"),
							startRecords: startIndex,
							pageSize: 10
						},
						success: function(respData) {
							if (respData.status == "SUCCESS") {
								plus.nativeUI.closeWaiting();
								$("#messageListID").show();

								var strFatherID = plus.webview.currentWebview().opener();
								mui.fire(strFatherID, 'messageCountRest');

								if (typeof(respData.data) != "undefined") {
									if (typeof(respData.data.event_list) != "undefined") {
										msgVue.mesList = respData.data.event_list;
										var pagecount = respData.data.total_records / 10;
										setFenyefunction(Math.ceil(pagecount), thisIndex);
									} else {
										mui.toast('暂无消息！');
									}
								} else {

									mui.toast('暂无消息!');
								}
							} else {
								plus.nativeUI.closeWaiting();
								mui.toast('获取消息失败，请重试！');
							}
						},
						error: function(error) {
							plus.nativeUI.closeWaiting();
							mui.toast('获取数据失败，请检查网络连接...');
						}
					});
				}


				function setFenyefunction(totalCount, thisIndex) {

					$('#pagination_9').whjPaging({
						css: 'css-user',
						totalPage: totalCount,
						isShowTotalSize: false,
						isShowTotalPage: true,
						isShowRefresh: false,
						isShowSkip: false,
						isShowPageSizeOpt: false,
						isShowFL: false,
						callBack: function(currPage) {
							console.log('currPage:' + currPage);
							var indexPage = currPage;
							if (indexPage == 1) {
								getBaoGaoList(0, indexPage);
							} else {
								var startIndex = (indexPage - 1) * 10;
								getBaoGaoList(startIndex, indexPage);
							}

						}
					});

					$("#pagination_9").whjPaging("setPage", {
						currPage: thisIndex,
						totalPage: totalCount,
						totalSize: 90
					});
				}
			})
		</script>
	</body>

</html>
